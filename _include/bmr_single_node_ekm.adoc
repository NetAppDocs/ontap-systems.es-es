= 
:allow-uri-read: 


Es posible restaurar la imagen ONTAP (recuperación del medio de arranque) desde el nodo asociado mediante `boot_recovery -partner` las plataformas ASA R2 que ejecutan ONTAP 9.16,0 y versiones posteriores.

Cuando arranca un nodo y el soporte de arranque de dicho nodo está dañado, verá los siguientes mensajes y el proceso de arranque con stop en el símbolo del sistema de Loader:

....

Can't find primary boot device u0a.0
Can't find backup boot device u0a.1
ACPI RSDP Found at 0x777fe014


Starting AUTOBOOT press Ctrl-C to abort...
Could not load fat://boot0/X86_64/freebsd/image1/kernel:Device not found

ERROR: Error booting OS on: 'boot0' file: fat://boot0/X86_64/Linux/image1/vmlinuz (boot0,fat)


ERROR: Error booting OS on: 'boot0' file: fat://boot0/X86_64/freebsd/image1/kernel (boot0,fat)


Autoboot of PRIMARY image failed. Device not found (-6)
LOADER-A>
....
Si ve este mensaje, debe restaurar la imagen de ONTAP.

.Pasos
. En el símbolo del sistema DE Loader, introduzca el comando _boot_recovery -partner_.
+
La pantalla mostrará el mensaje `Starting boot media recovery (BMR) process press Ctrl-C to abort...` e iniciará las comprobaciones iniciales y la instalación de los archivos de recuperación de arranque.

+
.. Si External Key Manager (EKM) está configurado, aparecerá lo siguiente:
+
....
Error when fetching key manager config from partner 169.254.139.209: 28
Has key manager been configured on this system? {y|n}
....
.. Introduzca _y_ si se ha configurado un gestor de claves.
+
....
key manager is configured.
Entering Bootmenu Option 11...
....


+
La opción bootmenu 11 solicitará al usuario toda la información de configuración de EKM para que los archivos de configuración puedan ser reconstruidos.

. Introduzca la configuración de EKM en cada petición de datos.
+
*NOTA:* La mayor parte de esta información fue ingresada cuando EKM fue originalmente habilitado. Debe introducir la misma información que se introdujo durante la configuración inicial de EKM.

. Compruebe que `Keystore UUID` los y `Cluster UUID` son correctos.
+
.. En el nodo del partner, recupere el UUID de clúster con  `cluster identity show`el comando.
.. En el nodo asociado, recupere el UUID de almacén de claves con el `vserver show -type admin` comando y `key-manager keystore show -vserver <nodename>` el comando.
.. Introduzca los valores para UUID del almacén de claves y UUID de clúster cuando se le solicite.
+
*NOTA:* Si el nodo asociado no está disponible, el UUID de almacén de claves y el UUID de clúster se pueden obtener de la clave Mroot-AK ubicada en el servidor de claves configurado.

+
Verifique `x-NETAPP-ClusterName: <cluster name>` para el UUID de clúster y `x-NETAPP-KeyUsage: "MROOT-AK"` los atributos de UUID de almacén de claves a fin de asegurarse de tener las claves correctas.



. Supervise la recuperación y restauración de Mroot-AK en el nodo ONTAP.
. Si el proceso no puede restaurar la clave, verá el siguiente mensaje y deberá configurar e0M desde el shell del sistema de menús:
+
....
ERROR: kmip_init: halting this system with encrypted mroot...
WARNING: kmip_init: authentication keys might not be available.
********************************************************
*                 A T T E N T I O N                    *
*                                                      *
*       System cannot connect to key managers.         *
*                                                      *
********************************************************
ERROR: kmip_init: halting this system with encrypted mroot...
.
Terminated

Uptime: 11m32s
System halting...

LOADER-B>

....
+
.. Ejecute `boot_recovery -partner` el comando en el nodo de recuperación.
.. Cuando se le solicite que realice (y o n) las opciones para EKM, seleccione _n_ para todos.
+
Después de seleccionar la opción _n_ para las indicaciones de 8, el sistema se detendrá en el menú de inicio.

.. Recopile la información del archivo /cfcard/kmip/servers.cfg de otro nodo del clúster. Usted recopilará la siguiente información:
+
*** La dirección del servidor KMIP.
*** El puerto KMIP.
*** UUID del almacén de claves.
*** Una copia del certificado de cliente del archivo /cfcard/kmip/certs/client.crt.
*** Una copia de la clave de cliente del archivo /cfcard/kmip/certs/client.key.
*** Una copia de las CA del servidor KMIP del archivo /cfcard/kmip/certs/CA.pem.


.. Introduzca systemshell desde el menú de inicio introduciendo _systemshell_ en el prompt.
.. Configure la red desde el menú systemshell para e0M, máscara de red y puerta de enlace.
.. Salga del menú systemshell con el comando _exit_.
.. Verá el menú de arranque. Seleccione la opción `11` para continuar con la restauración de EKM.
.. Responda `y` a las siguientes preguntas e introduzca la información obligatoria que haya recopilado anteriormente cuando se le solicite:
+
*** ¿Tiene una copia del archivo /cfcard/kmip/certs/client.crt? {s/n}
*** ¿Tiene una copia del archivo /cfcard/kmip/certs/client.key? {s/n}
*** ¿Tiene una copia del archivo /cfcard/kmip/certs/ca.pem? {s/n}
*** ¿Tiene una copia del archivo /cfcard/kmip/servers.cfg? {s/n}




. Si la clave se restaura correctamente, el proceso de recuperación continúa y reinicia el nodo.

